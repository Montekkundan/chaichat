{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "settings-appearance",
  "type": "registry:block",
  "title": "Settings Appearance",
  "description": "A settings panel for theme selection with light/dark toggle and Tweakcn theme URL input. Requires existing tweakcn-theme utilities.",
  "dependencies": [
    "next-themes",
    "lucide-react"
  ],
  "registryDependencies": [
    "button",
    "card",
    "input",
    "label",
    "badge"
  ],
  "files": [
    {
      "path": "src/registry/blocks/settings-appearance/settings-appearance.tsx",
      "content": "\"use client\";\n\nimport { ExternalLink, RotateCcw } from \"lucide-react\";\nimport { useTheme } from \"next-themes\";\nimport * as React from \"react\";\nimport { Badge } from \"~/components/ui/badge\";\nimport { Button } from \"~/components/ui/button\";\nimport {\n\tCard,\n\tCardContent,\n\tCardDescription,\n\tCardHeader,\n\tCardTitle,\n} from \"~/components/ui/card\";\nimport { Input } from \"~/components/ui/input\";\nimport { Label } from \"~/components/ui/label\";\nimport {\n\tTWEAKCN_THEME_RESET_EVENT,\n\ttype TweakcnThemeState,\n\tapplyTweakcnTheme,\n\tfetchTweakcnTheme,\n\tgetStoredTweakcnTheme,\n\tisTweakcnThemeActive,\n\tresetToDefaultTheme,\n} from \"~/lib/tweakcn-theme\";\n\ninterface SettingsAppearanceProps {\n\tclassName?: string;\n}\n\nexport function SettingsAppearance({ className }: SettingsAppearanceProps) {\n\tconst { theme, setTheme, resolvedTheme } = useTheme();\n\tconst [tweakcnTheme, setTweakcnTheme] =\n\t\tReact.useState<TweakcnThemeState | null>(null);\n\tconst [isTweakcnActive, setIsTweakcnActive] = React.useState(false);\n\tconst [themeUrl, setThemeUrl] = React.useState(\"\");\n\tconst [isLoading, setIsLoading] = React.useState(false);\n\tconst [mounted, setMounted] = React.useState(false);\n\tconst [isRestoringUrl, setIsRestoringUrl] = React.useState(true); // Track restoration phase\n\tconst [isUserAction, setIsUserAction] = React.useState(false); // Track if it's user-initiated\n\n\tReact.useEffect(() => {\n\t\tsetMounted(true);\n\n\t\t// Let the theme provider handle initial restoration\n\t\t// Just sync the component state with what's stored\n\t\tconst syncWithStoredTheme = () => {\n\t\t\tconst storedTheme = getStoredTweakcnTheme();\n\t\t\tconst isActive = isTweakcnThemeActive();\n\n\t\t\tsetTweakcnTheme(storedTheme);\n\t\t\tsetIsTweakcnActive(isActive);\n\n\t\t\t// Restore the theme URL from localStorage if available\n\t\t\ttry {\n\t\t\t\tconst storedUrl = localStorage.getItem(\"chai-tweakcn-theme-url\");\n\t\t\t\tif (storedUrl && storedTheme) {\n\t\t\t\t\tsetThemeUrl(storedUrl);\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"Failed to restore theme URL:\", error);\n\t\t\t}\n\n\t\t\t// Mark restoration as complete\n\t\t\tsetIsRestoringUrl(false);\n\t\t};\n\n\t\t// Initial sync after a brief delay to let theme provider initialize\n\t\tconst timeoutId = setTimeout(syncWithStoredTheme, 150);\n\n\t\treturn () => clearTimeout(timeoutId);\n\t}, []);\n\n\tReact.useEffect(() => {\n\t\tconst handleThemeReset = () => {\n\t\t\tsetTweakcnTheme(null);\n\t\t\tsetIsTweakcnActive(false);\n\t\t\tsetThemeUrl(\"\");\n\t\t};\n\n\t\twindow.addEventListener(TWEAKCN_THEME_RESET_EVENT, handleThemeReset);\n\t\treturn () => {\n\t\t\twindow.removeEventListener(TWEAKCN_THEME_RESET_EVENT, handleThemeReset);\n\t\t};\n\t}, []);\n\n\tReact.useEffect(() => {\n\t\tif (tweakcnTheme && resolvedTheme) {\n\t\t\tconst newMode = resolvedTheme === \"dark\" ? \"dark\" : \"light\";\n\t\t\tif (tweakcnTheme.currentMode !== newMode) {\n\t\t\t\tconst syncedTheme = {\n\t\t\t\t\t...tweakcnTheme,\n\t\t\t\t\tcurrentMode: newMode as \"dark\" | \"light\",\n\t\t\t\t};\n\t\t\t\tsetTweakcnTheme(syncedTheme);\n\t\t\t\tapplyTweakcnTheme(syncedTheme, true);\n\t\t\t}\n\t\t}\n\t}, [resolvedTheme, tweakcnTheme]);\n\n\tReact.useEffect(() => {\n\t\t// Don't process empty URLs during initial mount when restoring from localStorage\n\t\tif (!themeUrl.trim()) {\n\t\t\t// Only reset theme if we're not in the restoration phase and there was a theme active\n\t\t\tif (!isRestoringUrl && mounted && tweakcnTheme) {\n\t\t\t\tresetToDefaultTheme();\n\t\t\t\tsetTweakcnTheme(null);\n\t\t\t\tsetIsTweakcnActive(false);\n\t\t\t\t// Also clear the stored URL\n\t\t\t\ttry {\n\t\t\t\t\tlocalStorage.removeItem(\"chai-tweakcn-theme-url\");\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.error(\"Failed to clear theme URL:\", error);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif (!themeUrl.startsWith(\"https://tweakcn.com/r/themes/\")) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst timeoutId = setTimeout(async () => {\n\t\t\tsetIsLoading(true);\n\t\t\ttry {\n\t\t\t\tconst theme = await fetchTweakcnTheme(themeUrl);\n\t\t\t\tif (theme) {\n\t\t\t\t\tconst syncedTheme = {\n\t\t\t\t\t\t...theme,\n\t\t\t\t\t\tcurrentMode: (resolvedTheme === \"dark\" ? \"dark\" : \"light\") as\n\t\t\t\t\t\t\t| \"dark\"\n\t\t\t\t\t\t\t| \"light\",\n\t\t\t\t\t};\n\t\t\t\t\tsetTweakcnTheme(syncedTheme);\n\t\t\t\t\tapplyTweakcnTheme(syncedTheme);\n\t\t\t\t\tsetIsTweakcnActive(true);\n\n\t\t\t\t\t// Persist the theme URL\n\t\t\t\t\ttry {\n\t\t\t\t\t\tlocalStorage.setItem(\"chai-tweakcn-theme-url\", themeUrl);\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tconsole.error(\"Failed to store theme URL:\", error);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconsole.error(\"Failed to load theme\");\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(\"Error fetching theme:\", error);\n\t\t\t} finally {\n\t\t\t\tsetIsLoading(false);\n\t\t\t\tsetIsUserAction(false); // Reset the flag\n\t\t\t}\n\t\t}, 1000);\n\n\t\treturn () => clearTimeout(timeoutId);\n\t}, [themeUrl, resolvedTheme, mounted, isRestoringUrl, tweakcnTheme]);\n\n\tconst handleResetTheme = () => {\n\t\tresetToDefaultTheme();\n\t\tsetTweakcnTheme(null);\n\t\tsetIsTweakcnActive(false);\n\t\tsetThemeUrl(\"\");\n\t\tsetIsRestoringUrl(false); // Ensure we're not in restoration mode\n\n\t\t// Clear the stored URL\n\t\ttry {\n\t\t\tlocalStorage.removeItem(\"chai-tweakcn-theme-url\");\n\t\t} catch (error) {\n\t\t\tconsole.error(\"Failed to clear theme URL:\", error);\n\t\t}\n\n\t\t// Force a re-render to ensure UI updates\n\t\tsetTimeout(() => {\n\t\t\tsetMounted(false);\n\t\t\tsetTimeout(() => setMounted(true), 50);\n\t\t}, 100);\n\t};\n\n\tif (!mounted) {\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<div className={className}>\n\t\t\t<div className=\"space-y-4\">\n\t\t\t\t<div>\n\t\t\t\t\t<h2 className=\"font-bold text-xl\">Appearance</h2>\n\t\t\t\t\t<p className=\"text-muted-foreground text-sm\">\n\t\t\t\t\t\tCustomize the appearance of your application.\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-base\">Theme Mode</CardTitle>\n\t\t\t\t\t\t<CardDescription className=\"text-xs\">\n\t\t\t\t\t\t\tSelect the theme mode for the application.\n\t\t\t\t\t\t</CardDescription>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent>\n\t\t\t\t\t\t<div className=\"grid grid-cols-3 gap-3\">\n\t\t\t\t\t\t\t<div className=\"flex items-center space-x-2\">\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype=\"radio\"\n\t\t\t\t\t\t\t\t\tvalue=\"light\"\n\t\t\t\t\t\t\t\t\tid=\"light\"\n\t\t\t\t\t\t\t\t\tchecked={theme === \"light\"}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setTheme(e.target.value)}\n\t\t\t\t\t\t\t\t\tclassName=\"rounded\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<Label htmlFor=\"light\" className=\"text-sm\">\n\t\t\t\t\t\t\t\t\tLight\n\t\t\t\t\t\t\t\t</Label>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div className=\"flex items-center space-x-2\">\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype=\"radio\"\n\t\t\t\t\t\t\t\t\tvalue=\"dark\"\n\t\t\t\t\t\t\t\t\tid=\"dark\"\n\t\t\t\t\t\t\t\t\tchecked={theme === \"dark\"}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setTheme(e.target.value)}\n\t\t\t\t\t\t\t\t\tclassName=\"rounded\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<Label htmlFor=\"dark\" className=\"text-sm\">\n\t\t\t\t\t\t\t\t\tDark\n\t\t\t\t\t\t\t\t</Label>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div className=\"flex items-center space-x-2\">\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype=\"radio\"\n\t\t\t\t\t\t\t\t\tvalue=\"system\"\n\t\t\t\t\t\t\t\t\tid=\"system\"\n\t\t\t\t\t\t\t\t\tchecked={theme === \"system\"}\n\t\t\t\t\t\t\t\t\tonChange={(e) => setTheme(e.target.value)}\n\t\t\t\t\t\t\t\t\tclassName=\"rounded\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t<Label htmlFor=\"system\" className=\"text-sm\">\n\t\t\t\t\t\t\t\t\tSystem\n\t\t\t\t\t\t\t\t</Label>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\n\t\t\t\t<Card>\n\t\t\t\t\t<CardHeader className=\"pb-3\">\n\t\t\t\t\t\t<CardTitle className=\"text-base\">Custom Theme</CardTitle>\n\t\t\t\t\t\t<CardDescription className=\"text-xs\">\n\t\t\t\t\t\t\tImport and apply custom themes from Tweakcn.com\n\t\t\t\t\t\t</CardDescription>\n\t\t\t\t\t</CardHeader>\n\t\t\t\t\t<CardContent className=\"space-y-3\">\n\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t<div className=\"flex items-center space-x-2\">\n\t\t\t\t\t\t\t\t<span className=\"font-medium text-xs\">Status:</span>\n\t\t\t\t\t\t\t\t{tweakcnTheme ? (\n\t\t\t\t\t\t\t\t\t<Badge variant=\"default\" className=\"bg-green-500 text-xs\">\n\t\t\t\t\t\t\t\t\t\tLoaded ({tweakcnTheme.preset})\n\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t<Badge variant=\"secondary\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\tNo theme loaded\n\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\tonClick={() => window.open(\"https://tweakcn.com\", \"_blank\")}\n\t\t\t\t\t\t\t\tclassName=\"h-7 px-2\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<ExternalLink className=\"mr-1 h-3 w-3\" />\n\t\t\t\t\t\t\t\t<span className=\"text-xs\">Visit</span>\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t<Label htmlFor=\"theme-url\" className=\"text-xs\">\n\t\t\t\t\t\t\t\tTheme URL (auto-applies)\n\t\t\t\t\t\t\t</Label>\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tid=\"theme-url\"\n\t\t\t\t\t\t\t\tplaceholder=\"https://tweakcn.com/r/themes/twitter.json\"\n\t\t\t\t\t\t\t\tvalue={themeUrl}\n\t\t\t\t\t\t\t\tonChange={(e) => {\n\t\t\t\t\t\t\t\t\tsetThemeUrl(e.target.value);\n\t\t\t\t\t\t\t\t\tsetIsUserAction(true); // Mark as user action\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tclassName=\"text-xs\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t{isLoading && (\n\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\tLoading theme...\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tonClick={handleResetTheme}\n\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\tdisabled={!isTweakcnActive}\n\t\t\t\t\t\t\tclassName=\"h-8 w-full\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<RotateCcw className=\"mr-2 h-3 w-3\" />\n\t\t\t\t\t\t\t<span className=\"text-xs\">Reset to Default</span>\n\t\t\t\t\t\t</Button>\n\n\t\t\t\t\t\t{isTweakcnActive && (\n\t\t\t\t\t\t\t<div className=\"rounded-md border border-green-200 bg-green-50 p-3 dark:border-green-800 dark:bg-green-950\">\n\t\t\t\t\t\t\t\t<p className=\"text-green-600 text-xs dark:text-green-400\">\n\t\t\t\t\t\t\t\t\tCustom Tweakcn theme is currently active\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</CardContent>\n\t\t\t\t</Card>\n\t\t\t</div>\n\t\t</div>\n\t);\n}\n",
      "type": "registry:component"
    }
  ],
  "docs": "This component integrates with your existing ~/lib/tweakcn-theme utilities and theme provider. Make sure you have the tweakcn-theme system set up in your project."
}