{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "model-selector",
  "type": "registry:block",
  "title": "Model Selector",
  "description": "Dropdown to browse and select models (LLM Gateway or AI Gateway).",
  "dependencies": [
    "@phosphor-icons/react",
    "@ai-sdk/gateway"
  ],
  "registryDependencies": [
    "badge",
    "button",
    "drawer",
    "dropdown-menu",
    "input",
    "label",
    "popover",
    "separator",
    "switch",
    "tooltip"
  ],
  "files": [
    {
      "path": "src/registry/blocks/model-selector/model-selector.tsx",
      "content": "\"use client\";\n\nimport {\n\tCaretDownIcon,\n\tCheckCircleIcon,\n\tInfoIcon,\n\tMagnifyingGlassIcon,\n\tSlidersHorizontalIcon,\n\tXCircleIcon,\n} from \"@phosphor-icons/react\";\nimport { useCallback, useEffect, useMemo, useRef, useState } from \"react\";\nimport { Badge } from \"~/components/ui/badge\";\nimport { Button } from \"~/components/ui/button\";\nimport {\n\tDrawer,\n\tDrawerContent,\n\tDrawerHeader,\n\tDrawerTitle,\n\tDrawerTrigger,\n} from \"~/components/ui/drawer\";\nimport {\n\tDropdownMenu,\n\tDropdownMenuContent,\n\tDropdownMenuTrigger,\n} from \"~/components/ui/dropdown-menu\";\nimport { Input } from \"~/components/ui/input\";\nimport { Label } from \"~/components/ui/label\";\nimport {\n\tPopover,\n\tPopoverContent,\n\tPopoverTrigger,\n} from \"~/components/ui/popover\";\nimport { Separator } from \"~/components/ui/separator\";\nimport { Switch } from \"~/components/ui/switch\";\nimport {\n\tTooltip,\n\tTooltipContent,\n\tTooltipProvider,\n\tTooltipTrigger,\n} from \"~/components/ui/tooltip\";\nimport { cn } from \"~/lib/utils\";\nimport { useLLMModels } from \"./use-models\";\n\nexport interface Model {\n\tid: string;\n\tname: string;\n\tdescription?: string;\n\tfamily?: string;\n\tcontext_length?: number;\n\tarchitecture?: {\n\t\tinput_modalities?: string[];\n\t\toutput_modalities?: string[];\n\t\ttokenizer?: string;\n\t};\n\tpricing?: {\n\t\tprompt?: string;\n\t\tcompletion?: string;\n\t\t[key: string]: string | undefined;\n\t};\n\tproviders?: Array<{\n\t\tproviderId: string;\n\t\tmodelName: string;\n\t\tstreaming?: boolean;\n\t\tvision?: boolean;\n\t\ttools?: boolean;\n\t\tpricing?: {\n\t\t\tprompt?: string;\n\t\t\tcompletion?: string;\n\t\t\tinput?: string;\n\t\t\toutput?: string;\n\t\t\t[key: string]: string | undefined;\n\t\t};\n\t}>;\n\tsupported_parameters?: string[];\n\tjson_output?: boolean;\n\ttop_provider?: {\n\t\tis_moderated?: boolean;\n\t};\n\tdeactivated_at?: string;\n\tdeprecated_at?: string;\n}\n\ntype ModelSelectorProps = {\n\tselectedModelId?: string;\n\tsetSelectedModelId?: (modelId: string) => void;\n\tmodels?: Model[];\n\tisLoading?: boolean;\n\terror?: string;\n\tclassName?: string;\n\tsource?: \"aigateway\" | \"llmgateway\";\n\tonSourceChange?: (source: \"aigateway\" | \"llmgateway\") => void;\n};\n\ntype ModelStatusFilter = \"any\" | \"active\" | \"deprecated\" | \"deactivated\";\n\nfunction ModelSelector({\n\tselectedModelId,\n\tsetSelectedModelId,\n\tmodels: modelsProp,\n\tisLoading = false,\n\terror,\n\tclassName,\n\tsource,\n\tonSourceChange,\n}: ModelSelectorProps) {\n\tconst isControlled = typeof source === \"string\";\n\tconst [isDrawerOpen, setIsDrawerOpen] = useState(false);\n\tconst [isDropdownOpen, setIsDropdownOpen] = useState(false);\n\tconst [searchQuery, setSearchQuery] = useState(\"\");\n\tconst [debouncedSearchQuery, setDebouncedSearchQuery] = useState(\"\");\n\tconst [expandedModels, setExpandedModels] = useState<Set<string>>(new Set());\n\tconst [filters, setFilters] = useState({\n\t\tstreaming: false,\n\t\tvision: false,\n\t\ttools: false,\n\t\tjsonOutput: false,\n\t\tmoderatedMode: \"any\" as \"any\" | \"moderated\" | \"unmoderated\",\n\t\tstatus: \"any\" as ModelStatusFilter,\n\t\tproviderQuery: \"\",\n\t\tminContext: \"\" as string | number,\n\t\tmaxPromptPrice: \"\" as string | number, // in $ per 1K tokens\n\t});\n\tconst searchInputRef = useRef<HTMLInputElement>(null);\n\tconst [useAiGateway, setUseAiGateway] = useState<boolean>(false);\n\tconst [isMobile, setIsMobile] = useState<boolean>(false);\n\tconst [hasAiGatewayKey, setHasAiGatewayKey] = useState<boolean>(false);\n\tconst [internalSelectedModelId, setInternalSelectedModelId] = useState<string>(\"\");\n\n\tconst setSelectedModelIdSafe = useCallback(\n\t\t(nextId: string) => {\n\t\t\tif (typeof setSelectedModelId === \"function\") {\n\t\t\t\ttry {\n\t\t\t\t\tsetSelectedModelId(nextId);\n\t\t\t\t} catch {}\n\t\t\t} else {\n\t\t\t\tsetInternalSelectedModelId(nextId);\n\t\t\t}\n\t\t},\n\t\t[setSelectedModelId],\n\t);\n\n\tconst hook = useLLMModels(\n\t\tisControlled ? { source, controlled: true } : undefined,\n\t);\n\tconst models = (modelsProp && modelsProp.length > 0\n\t\t? modelsProp\n\t\t: (hook.models as unknown as Model[])) as Model[];\n\tconst loading = isLoading || (!modelsProp && hook.isLoading);\n\tconst err = error || (!modelsProp ? hook.error || undefined : undefined);\n\n\tconst currentSelectedModelId = selectedModelId ?? internalSelectedModelId;\n\n\tuseEffect(() => {\n\t\tconst checkMobile = () => setIsMobile(window.innerWidth < 768);\n\t\tcheckMobile();\n\t\twindow.addEventListener('resize', checkMobile);\n\t\treturn () => window.removeEventListener('resize', checkMobile);\n\t}, []);\n\n\tuseEffect(() => {\n\t\t// Focus search input when the dropdown opens on desktop\n\t\tif (!isMobile && isDropdownOpen) {\n\t\t\tconst id = window.setTimeout(() => {\n\t\t\t\tsearchInputRef.current?.focus();\n\t\t\t\tsearchInputRef.current?.select?.();\n\t\t\t}, 0);\n\t\t\treturn () => window.clearTimeout(id);\n\t\t}\n\t}, [isDropdownOpen, isMobile]);\n\n\tuseEffect(() => {\n\t\tif (isControlled) {\n\t\t\tsetUseAiGateway(source === \"aigateway\");\n\t\t\treturn;\n\t\t}\n\t\ttry {\n\t\t\tconst raw = window.localStorage.getItem(\"chaichat_registry_models_source\");\n\t\t\tsetUseAiGateway(raw === \"aigateway\");\n\t\t} catch {}\n\t\tconst sync = () => {\n\t\t\ttry {\n\t\t\t\tconst raw = window.localStorage.getItem(\"chaichat_registry_models_source\");\n\t\t\t\tsetUseAiGateway(raw === \"aigateway\");\n\t\t\t} catch {}\n\t\t};\n\t\twindow.addEventListener(\"registryModelsSourceChanged\", sync as EventListener);\n\t\twindow.addEventListener(\"storage\", sync);\n\t\treturn () => {\n\t\t\twindow.removeEventListener(\"registryModelsSourceChanged\", sync as EventListener);\n\t\t\twindow.removeEventListener(\"storage\", sync);\n\t\t};\n\t}, [isControlled, source]);\n\n\tuseEffect(() => {\n\t\tconst readKeys = () => {\n\t\t\ttry {\n\t\t\t\tconst fallback = window.localStorage?.getItem(\"chaichat_registry_aigateway\");\n\t\t\t\tsetHasAiGatewayKey(Boolean(fallback?.trim()));\n\t\t\t} catch {\n\t\t\t\tsetHasAiGatewayKey(false);\n\t\t\t}\n\t\t};\n\t\treadKeys();\n\t\tconst onKeysChanged = () => readKeys();\n\t\twindow.addEventListener(\"apiKeysChanged\", onKeysChanged);\n\t\treturn () => window.removeEventListener(\"apiKeysChanged\", onKeysChanged);\n\t}, []);\n\n\tuseEffect(() => {\n\t\tif (!hasAiGatewayKey && useAiGateway) {\n\t\t\tsetModelsSource(false);\n\t\t}\n\t}, [hasAiGatewayKey, useAiGateway]);\n\n\tconst setModelsSource = useCallback(\n\t\t(next: boolean) => {\n\t\t\tif (isControlled) {\n\t\t\t\tsetUseAiGateway(next);\n\t\t\t\tonSourceChange?.(next ? \"aigateway\" : \"llmgateway\");\n\t\t\t} else {\n\t\t\t\ttry {\n\t\t\t\t\twindow.localStorage.setItem(\n\t\t\t\t\t\t\"chaichat_registry_models_source\",\n\t\t\t\t\t\tnext ? \"aigateway\" : \"llmgateway\",\n\t\t\t\t\t);\n\t\t\t\t\twindow.dispatchEvent(new CustomEvent(\"registryModelsSourceChanged\"));\n\t\t\t\t} catch {}\n\t\t\t\tsetUseAiGateway(next);\n\t\t\t}\n\t\t},\n\t\t[isControlled, onSourceChange],\n\t);\n\n\n\n\tuseEffect(() => {\n\t\tif (isMobile && isDrawerOpen) {\n\t\t\tconst id = window.setTimeout(() => {\n\t\t\t\tsearchInputRef.current?.focus();\n\t\t\t\tsearchInputRef.current?.select?.();\n\t\t\t}, 0);\n\t\t\treturn () => window.clearTimeout(id);\n\t\t}\n\t}, [isDrawerOpen, isMobile]);\n\n\n\n\tuseEffect(() => {\n\t\tif ((!currentSelectedModelId || currentSelectedModelId === \"\") && models && models.length > 0 && models[0]) {\n\t\t\tsetSelectedModelIdSafe(models[0].id);\n\t\t}\n\t}, [currentSelectedModelId, models, setSelectedModelIdSafe]);\n\n\tuseEffect(() => {\n\t\tconst handleKeyDown = (e: KeyboardEvent) => {\n\t\t\tif ((e.key === \"p\" || e.key === \"P\") && e.metaKey && e.shiftKey) {\n\t\t\t\te.preventDefault();\n\t\t\t\tif (isMobile) {\n\t\t\t\t\tsetIsDrawerOpen((prev) => !prev);\n\t\t\t\t} else {\n\t\t\t\t\tsetIsDropdownOpen((prev) => !prev);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tdocument.addEventListener(\"keydown\", handleKeyDown);\n\t\treturn () => document.removeEventListener(\"keydown\", handleKeyDown);\n\t}, [isMobile]);\n\n\tconst canonicalSelectedKey = useMemo(() => {\n\t\tif (!currentSelectedModelId) return null as string | null;\n\t\tconst makeKey = (m: Model) => `${m.id}::${m.name}`;\n\t\tif (currentSelectedModelId.includes(\"/\")) {\n\t\t\tconst firstSlashIndex = currentSelectedModelId.indexOf(\"/\");\n\t\t\tconst provider = currentSelectedModelId.substring(0, firstSlashIndex);\n\t\t\tconst modelName = currentSelectedModelId.substring(firstSlashIndex + 1);\n\t\t\tconst match = (models || []).find((m) =>\n\t\t\t\tm.providers?.some(\n\t\t\t\t\t(p) => p.providerId === provider && p.modelName === modelName,\n\t\t\t\t),\n\t\t\t);\n\t\t\tif (match) return makeKey(match);\n\t\t\t// Try exact match on full id/name (e.g. \"openai/gpt-4o\") for sources that encode provider in id\n\t\t\tconst exact = (models || []).find((m) => m.id === currentSelectedModelId || m.name === currentSelectedModelId);\n\t\t\tif (exact) return makeKey(exact);\n\t\t\t// Fallback: match by the model name part after the slash\n\t\t\tconst fallback = (models || []).find((m) => m.id === modelName || m.name === modelName);\n\t\t\treturn fallback ? makeKey(fallback) : null;\n\t\t}\n\t\tconst byName = (models || []).find((m) => m.name === currentSelectedModelId);\n\t\tif (byName) return makeKey(byName);\n\t\tconst byId = (models || []).find((m) => m.id === currentSelectedModelId);\n\t\treturn byId ? makeKey(byId) : null;\n\t}, [currentSelectedModelId, models]);\n\n\tconst isModelSelected = useCallback(\n\t\t(model: Model) => {\n\t\t\treturn canonicalSelectedKey === `${model.id}::${model.name}`;\n\t\t},\n\t\t[canonicalSelectedKey],\n\t);\n\tconst isProviderSelected = useCallback(\n\t\t(model: Model, providerId: string) => {\n\t\t\tif (!currentSelectedModelId || !currentSelectedModelId.includes(\"/\")) return false;\n\t\t\tconst firstSlashIndex = currentSelectedModelId.indexOf(\"/\");\n\t\t\tconst selectedProvider = currentSelectedModelId.substring(0, firstSlashIndex);\n\t\t\tconst selectedModelName = currentSelectedModelId.substring(firstSlashIndex + 1);\n\t\t\tif (selectedProvider !== providerId) return false;\n\t\t\tif (canonicalSelectedKey !== `${model.id}::${model.name}`) return false;\n\t\t\tconst provider = model.providers?.find(\n\t\t\t\t(p) => p.providerId === providerId,\n\t\t\t);\n\t\t\treturn provider?.modelName === selectedModelName;\n\t\t},\n\t\t[currentSelectedModelId, canonicalSelectedKey],\n\t);\n\n\tconst toggleModelExpanded = useCallback((modelId: string) => {\n\t\tsetExpandedModels((prev) => {\n\t\t\tconst newSet = new Set(prev);\n\t\t\tif (newSet.has(modelId)) {\n\t\t\t\tnewSet.delete(modelId);\n\t\t\t} else {\n\t\t\t\tnewSet.add(modelId);\n\t\t\t}\n\t\t\treturn newSet;\n\t\t});\n\t}, []);\n\n\tconst handleModelSelect = useCallback(\n\t\t(model: Model, providerId?: string) => {\n\t\t\tconst providerToUse = providerId || model.providers?.[0]?.providerId;\n\t\t\tconst selectedProvider = model.providers?.find(\n\t\t\t\t(p) => p.providerId === providerToUse,\n\t\t\t);\n\t\t\tconst modelName = selectedProvider?.modelName || model.name;\n\t\t\tconst modelString = providerToUse\n\t\t\t\t? `${providerToUse}/${modelName}`\n\t\t\t\t: model.id;\n\t\t\tsetSelectedModelIdSafe(modelString);\n\t\t\tif (isMobile) {\n\t\t\t\tsetIsDrawerOpen(false);\n\t\t\t} else {\n\t\t\t\tsetIsDropdownOpen(false);\n\t\t\t}\n\t\t},\n\t\t[isMobile, setSelectedModelIdSafe],\n\t);\n\n\tconst filteredModels = useMemo(\n\t\t() =>\n\t\t\t(models || [])\n\t\t\t\t.filter((model) => {\n\t\t\t\t\tconst query = debouncedSearchQuery.toLowerCase();\n\t\t\t\t\tconst textMatch =\n\t\t\t\t\t\tmodel.name.toLowerCase().includes(query) ||\n\t\t\t\t\t\t(model.family?.toLowerCase().includes(query) ?? false) ||\n\t\t\t\t\t\t(model.description?.toLowerCase().includes(query) ?? false) ||\n\t\t\t\t\t\tmodel.id.toLowerCase().includes(query) ||\n\t\t\t\t\t\t(model.providers?.some((p) =>\n\t\t\t\t\t\t\tp.providerId.toLowerCase().includes(query),\n\t\t\t\t\t\t) ??\n\t\t\t\t\t\t\tfalse) ||\n\t\t\t\t\t\t(model.supported_parameters?.some((p) =>\n\t\t\t\t\t\t\tp.toLowerCase().includes(query),\n\t\t\t\t\t\t) ??\n\t\t\t\t\t\t\tfalse);\n\n\t\t\t\t\t// Status filter\n\t\t\t\t\tif (filters.status !== \"any\") {\n\t\t\t\t\t\tconst isActive = !model.deactivated_at && !model.deprecated_at;\n\t\t\t\t\t\tif (filters.status === \"active\" && !isActive) return false;\n\t\t\t\t\t\tif (filters.status === \"deprecated\" && !model.deprecated_at)\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\tif (filters.status === \"deactivated\" && !model.deactivated_at)\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Feature toggles\n\t\t\t\t\tconst providers = model.providers ?? [];\n\t\t\t\t\tif (filters.streaming && !providers.some((p) => p.streaming))\n\t\t\t\t\t\treturn false;\n\t\t\t\t\tif (filters.vision && !providers.some((p) => p.vision)) return false;\n\t\t\t\t\tif (filters.tools && !providers.some((p) => p.tools)) return false;\n\t\t\t\t\tif (filters.jsonOutput && !model.json_output) return false;\n\t\t\t\t\tif (\n\t\t\t\t\t\tfilters.moderatedMode === \"moderated\" &&\n\t\t\t\t\t\t!model.top_provider?.is_moderated\n\t\t\t\t\t)\n\t\t\t\t\t\treturn false;\n\t\t\t\t\tif (\n\t\t\t\t\t\tfilters.moderatedMode === \"unmoderated\" &&\n\t\t\t\t\t\tmodel.top_provider?.is_moderated\n\t\t\t\t\t)\n\t\t\t\t\t\treturn false;\n\n\t\t\t\t\t// Provider substring filter\n\t\t\t\t\tif (filters.providerQuery) {\n\t\t\t\t\t\tconst pq = String(filters.providerQuery).toLowerCase();\n\t\t\t\t\t\tif (!providers.some((p) => p.providerId.toLowerCase().includes(pq)))\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Context length minimum\n\t\t\t\t\tif (filters.minContext !== \"\" && filters.minContext !== null) {\n\t\t\t\t\t\tconst minCtx = Number(filters.minContext);\n\t\t\t\t\t\tif (!Number.isNaN(minCtx) && (model.context_length ?? 0) < minCtx)\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Max prompt price (per 1K tokens) across any provider\n\t\t\t\t\tif (\n\t\t\t\t\t\tfilters.maxPromptPrice !== \"\" &&\n\t\t\t\t\t\tfilters.maxPromptPrice !== null\n\t\t\t\t\t) {\n\t\t\t\t\t\tconst maxPrice = Number(filters.maxPromptPrice);\n\t\t\t\t\t\tif (!Number.isNaN(maxPrice)) {\n\t\t\t\t\t\t\tconst providerPrices = providers\n\t\t\t\t\t\t\t\t.map((p) =>\n\t\t\t\t\t\t\t\t\tp.pricing?.prompt ? Number.parseFloat(p.pricing.prompt) : 0,\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t.filter((v) => !Number.isNaN(v));\n\t\t\t\t\t\t\tconst fallbackModelPrompt = model.pricing?.prompt\n\t\t\t\t\t\t\t\t? Number.parseFloat(model.pricing.prompt)\n\t\t\t\t\t\t\t\t: 0;\n\t\t\t\t\t\t\tconst minProviderPrice =\n\t\t\t\t\t\t\t\tproviderPrices.length > 0\n\t\t\t\t\t\t\t\t\t? Math.min(...providerPrices)\n\t\t\t\t\t\t\t\t\t: fallbackModelPrompt;\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t!Number.isNaN(minProviderPrice) &&\n\t\t\t\t\t\t\t\tminProviderPrice > maxPrice\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn textMatch;\n\t\t\t\t})\n\t\t\t\t.sort((a, b) => {\n\t\t\t\t\tconst aActive = !a.deactivated_at && !a.deprecated_at;\n\t\t\t\t\tconst bActive = !b.deactivated_at && !b.deprecated_at;\n\t\t\t\t\tif (aActive && !bActive) return -1;\n\t\t\t\t\tif (!aActive && bActive) return 1;\n\n\t\t\t\t\tconst aProviders = a.providers?.length || 0;\n\t\t\t\t\tconst bProviders = b.providers?.length || 0;\n\t\t\t\t\tif (aProviders !== bProviders) return bProviders - aProviders;\n\n\t\t\t\t\treturn (b.context_length || 0) - (a.context_length || 0);\n\t\t\t\t}),\n\t\t[models, debouncedSearchQuery, filters],\n\t);\n\n\tconst formatPrice = useCallback((price: string | undefined) => {\n\t\tif (!price || price === \"undefined\" || price === \"null\") return \"Free\";\n\t\tconst num = Number.parseFloat(price);\n\t\tif (Number.isNaN(num) || num === 0) return \"Free\";\n\t\tif (num < 0.001) return `$${(num * 1000000).toFixed(2)}/1M`;\n\t\tif (num < 1) return `$${(num * 1000).toFixed(2)}/1K`;\n\t\treturn `$${num.toFixed(2)}`;\n\t}, []);\n\n\tconst readDynamicPrice = useCallback(\n\t\t(obj: unknown, key: string): string | undefined => {\n\t\t\tif (\n\t\t\t\tobj &&\n\t\t\t\ttypeof obj === \"object\" &&\n\t\t\t\tkey in (obj as Record<string, unknown>)\n\t\t\t) {\n\t\t\t\tconst val = (obj as Record<string, unknown>)[key];\n\t\t\t\treturn typeof val === \"string\" ? val : undefined;\n\t\t\t}\n\t\t\treturn undefined;\n\t\t},\n\t\t[],\n\t);\n\n\tconst getStatusText = useCallback((model: Model) => {\n\t\tif (!model) return \"Unknown\";\n\t\tif (model.deactivated_at) return \"Deactivated\";\n\t\tif (model.deprecated_at) return \"Deprecated\";\n\t\treturn \"Active\";\n\t}, []);\n\n\tconst getDisplayText = useCallback(() => {\n\t\tif (!currentSelectedModelId) return \"Select model\";\n\t\tif (!models || models.length === 0) {\n\t\t\tif (currentSelectedModelId.includes(\"/\")) {\n\t\t\t\tconst parts = currentSelectedModelId.split(\"/\");\n\t\t\t\treturn parts[parts.length - 1] || currentSelectedModelId;\n\t\t\t}\n\t\t\treturn currentSelectedModelId;\n\t\t}\n\n\t\tif (currentSelectedModelId.includes(\"/\")) {\n\t\t\tconst firstSlashIndex = currentSelectedModelId.indexOf(\"/\");\n\t\t\tconst provider = currentSelectedModelId.substring(0, firstSlashIndex);\n\t\t\tconst modelName = currentSelectedModelId.substring(firstSlashIndex + 1);\n\n\t\t\tconst matchingModel = models.find((model) =>\n\t\t\t\tmodel.providers?.some(\n\t\t\t\t\t(p) => p.providerId === provider && p.modelName === modelName,\n\t\t\t\t),\n\t\t\t);\n\n\t\t\tif (matchingModel) {\n\t\t\t\treturn matchingModel.name;\n\t\t\t}\n\n\t\t\tconst modelPart = modelName?.split(\"/\").pop();\n\t\t\treturn modelPart || currentSelectedModelId;\n\t\t}\n\n\t\tconst model = models.find((m) => m.id === currentSelectedModelId || m.name === currentSelectedModelId);\n\t\treturn model ? model.name : currentSelectedModelId;\n\t}, [currentSelectedModelId, models]);\n\n\tconst handleSearchChange = useCallback(\n\t\t(e: React.ChangeEvent<HTMLInputElement>) => {\n\t\t\te.stopPropagation();\n\t\t\tsetSearchQuery(e.target.value);\n\t\t},\n\t\t[],\n\t);\n\n\tuseEffect(() => {\n\t\tconst id = window.setTimeout(\n\t\t\t() => setDebouncedSearchQuery(searchQuery),\n\t\t\t150,\n\t\t);\n\t\treturn () => window.clearTimeout(id);\n\t}, [searchQuery]);\n\n\tconst renderModelTooltip = useCallback(\n\t\t(model: Model) => {\n\t\t\t// For AI Gateway: show name + description only\n\t\t\tif (useAiGateway) {\n\t\t\t\treturn (\n\t\t\t\t\t<div className=\"w-80 space-y-0 bg-popover text-popover-foreground\">\n\t\t\t\t\t\t<div className=\"p-4 pb-3\">\n\t\t\t\t\t\t\t<div className=\"min-w-0\">\n\t\t\t\t\t\t\t\t<div className=\"font-semibold text-foreground text-sm\">\n\t\t\t\t\t\t\t\t\t{model.name}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div className=\"mt-1 text-muted-foreground text-xs leading-relaxed\">\n\t\t\t\t\t\t\t\t\t{model.description || \"No description available\"}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// For LLM Gateway: full details\n\t\t\treturn (\n\t\t\t\t<div className=\"w-80 space-y-0 bg-popover text-popover-foreground\">\n\t\t\t\t\t<div className=\"p-4 pb-3\">\n\t\t\t\t\t\t<div className=\"flex items-start justify-between gap-3\">\n\t\t\t\t\t\t\t<div className=\"min-w-0 flex-1\">\n\t\t\t\t\t\t\t\t<div className=\"font-semibold text-foreground text-sm\">\n\t\t\t\t\t\t\t\t\t{model.name}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div className=\"mt-1 text-muted-foreground text-xs leading-relaxed\">\n\t\t\t\t\t\t\t\t\t{model.description || \"No description available\"}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\"flex-shrink-0 rounded-full px-2 py-1 font-medium text-xs\",\n\t\t\t\t\t\t\t\t\tmodel.deactivated_at\n\t\t\t\t\t\t\t\t\t\t? \"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300\"\n\t\t\t\t\t\t\t\t\t\t: model.deprecated_at\n\t\t\t\t\t\t\t\t\t\t\t? \"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300\"\n\t\t\t\t\t\t\t\t\t\t\t: \"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300\",\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{getStatusText(model)}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<Separator />\n\n\t\t\t\t\t<div className=\"p-4 py-3\">\n\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-4 text-xs\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div className=\"mb-2 font-medium text-foreground\">\n\t\t\t\t\t\t\t\t\tArchitecture\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div className=\"space-y-1.5 text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">Input:</span>{\" \"}\n\t\t\t\t\t\t\t\t\t\t{model.architecture?.input_modalities?.join(\", \") || \"text\"}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">Output:</span>{\" \"}\n\t\t\t\t\t\t\t\t\t\t{model.architecture?.output_modalities?.join(\", \") ||\n\t\t\t\t\t\t\t\t\t\t\t\"text\"}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">Tokenizer:</span>{\" \"}\n\t\t\t\t\t\t\t\t\t\t{model.architecture?.tokenizer || \"GPT\"}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div className=\"mb-2 font-medium text-foreground\">Features</div>\n\t\t\t\t\t\t\t\t<div className=\"space-y-1.5\">\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t{model.providers?.[0]?.streaming ? (\n\t\t\t\t\t\t\t\t\t\t\t<CheckCircleIcon className=\"size-3 flex-shrink-0 text-green-500\" />\n\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t<XCircleIcon className=\"size-3 flex-shrink-0 text-red-500\" />\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t<span>Streaming</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t{model.providers?.[0]?.vision ? (\n\t\t\t\t\t\t\t\t\t\t\t<CheckCircleIcon className=\"size-3 flex-shrink-0 text-green-500\" />\n\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t<XCircleIcon className=\"size-3 flex-shrink-0 text-red-500\" />\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t<span>Vision</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t{model.providers?.[0]?.tools ? (\n\t\t\t\t\t\t\t\t\t\t\t<CheckCircleIcon className=\"size-3 flex-shrink-0 text-green-500\" />\n\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t<XCircleIcon className=\"size-3 flex-shrink-0 text-red-500\" />\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t<span>Function Calling</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2 text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t{model.json_output ? (\n\t\t\t\t\t\t\t\t\t\t\t<CheckCircleIcon className=\"size-3 flex-shrink-0 text-green-500\" />\n\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t<XCircleIcon className=\"size-3 flex-shrink-0 text-red-500\" />\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t<span>JSON Output</span>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{model.providers && model.providers.length > 0 && (\n\t\t\t\t\t\t<div className=\"p-4 py-3\">\n\t\t\t\t\t\t\t<div className=\"mb-3 font-medium text-foreground text-xs\">\n\t\t\t\t\t\t\t\tAvailable Providers ({model.providers.length})\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div className=\"space-y-2\">\n\t\t\t\t\t\t\t\t{model.providers.slice(0, 3).map((provider) => (\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tkey={`${provider.providerId}-${provider.modelName}`}\n\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\"cursor-pointer rounded-md bg-muted/50 px-3 py-2 text-xs transition-colors hover:bg-muted\",\n\t\t\t\t\t\t\t\t\t\t\tisProviderSelected(model, provider.providerId) &&\n\t\t\t\t\t\t\t\t\t\t\t\t\"bg-primary/10 ring-2 ring-primary\",\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\thandleModelSelect(model, provider.providerId);\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<div className=\"font-medium text-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t{provider.providerId}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"mt-0.5 text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t{formatPrice(\n\t\t\t\t\t\t\t\t\t\t\t\tprovider.pricing?.prompt ||\n\t\t\t\t\t\t\t\t\t\t\t\t\treadDynamicPrice(provider.pricing, \"input\") ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"0\",\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t/1K tokens\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t{model.providers.length > 3 && (\n\t\t\t\t\t\t\t\t\t<div className=\"pl-3 text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\t+{model.providers.length - 3} more providers (click model to\n\t\t\t\t\t\t\t\t\t\tsee all)\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{model.supported_parameters &&\n\t\t\t\t\t\tmodel.supported_parameters.length > 0 && (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<Separator />\n\t\t\t\t\t\t\t\t<div className=\"p-4 py-3\">\n\t\t\t\t\t\t\t\t\t<div className=\"mb-3 font-medium text-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\tSupported Parameters\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"flex flex-wrap gap-1.5\">\n\t\t\t\t\t\t\t\t\t\t{model.supported_parameters.slice(0, 8).map((param) => (\n\t\t\t\t\t\t\t\t\t\t\t<Badge\n\t\t\t\t\t\t\t\t\t\t\t\tkey={param}\n\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"outline\"\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-5 px-2 text-xs\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{param}\n\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t\t{model.supported_parameters.length > 8 && (\n\t\t\t\t\t\t\t\t\t\t\t<Badge variant=\"outline\" className=\"h-5 px-2 text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t+{model.supported_parameters.length - 8}\n\t\t\t\t\t\t\t\t\t\t\t</Badge>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t)}\n\n\t\t\t\t\t{(model.deprecated_at || model.deactivated_at) && (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<Separator />\n\t\t\t\t\t\t\t<div className=\"p-4 py-3\">\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\"flex items-center gap-2 rounded-md p-2 text-xs\",\n\t\t\t\t\t\t\t\t\t\tmodel.deactivated_at\n\t\t\t\t\t\t\t\t\t\t\t? \"border border-red-200 bg-red-50 text-red-700 dark:border-red-800 dark:bg-red-900/20 dark:text-red-300\"\n\t\t\t\t\t\t\t\t\t\t\t: \"border border-yellow-200 bg-yellow-50 text-yellow-700 dark:border-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-300\",\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<InfoIcon className=\"size-3 flex-shrink-0\" />\n\t\t\t\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t\t\t\t{model.deactivated_at\n\t\t\t\t\t\t\t\t\t\t\t? \"This model has been deactivated and is no longer available.\"\n\t\t\t\t\t\t\t\t\t\t\t: \"This model is deprecated and may be removed in the future.\"}\n\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t);\n\t\t},\n\t\t[\n\t\t\tuseAiGateway,\n\t\t\tgetStatusText,\n\t\t\tisProviderSelected,\n\t\t\thandleModelSelect,\n\t\t\tformatPrice,\n\t\t\treadDynamicPrice,\n\t\t],\n\t);\n\n\tconst duplicateModelIdsRef = useRef<Set<string>>(new Set());\n\n\tuseEffect(() => {\n\t\tconst counts = new Map<string, number>();\n\t\tfor (const m of (models || [])) {\n\t\t\tcounts.set(m.id, (counts.get(m.id) || 0) + 1);\n\t\t}\n\t\tduplicateModelIdsRef.current = new Set(\n\t\t\tArray.from(counts.entries())\n\t\t\t\t.filter(([, c]) => c > 1)\n\t\t\t\t.map(([id]) => id),\n\t\t);\n\t}, [models]);\n\n\tconst renderModelItem = useCallback(\n\t\t(model: Model) => (\n\t\t\t<TooltipProvider key={`${model.id}::${model.name}`}>\n\t\t\t\t<Tooltip delayDuration={300}>\n\t\t\t\t\t<TooltipTrigger asChild>\n\t\t\t\t\t\t<div className=\"w-full\">\n\t\t\t\t\t\t\t<div className=\"flex w-full items-center justify-between gap-2\">\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\"flex w-full flex-1 cursor-pointer items-center justify-between rounded-md px-3 py-2 transition-colors hover:bg-accent\",\n\t\t\t\t\t\t\t\t\t\tisModelSelected(model) &&\n\t\t\t\t\t\t\t\t\t\t\t\"border border-primary/30 bg-accent\",\n\t\t\t\t\t\t\t\t\t\tmodel.deactivated_at && \"opacity-60\",\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\tonClick={() => handleModelSelect(model)}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div className=\"flex min-w-0 flex-1 items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"truncate font-medium text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t{model.name}\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{isModelSelected(model) && (\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"size-2 flex-shrink-0 rounded-full bg-primary\" />\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\t{formatPrice(model.pricing?.prompt || \"0\")}/1K\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t\t\t{model.providers && model.providers.length > 1 && (\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\tclassName=\"h-8 w-8 p-0 hover:bg-accent/50\"\n\t\t\t\t\t\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\ttoggleModelExpanded(model.id);\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<CaretDownIcon\n\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\"size-3 transition-transform\",\n\t\t\t\t\t\t\t\t\t\t\t\texpandedModels.has(model.id) && \"rotate-180\",\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t{expandedModels.has(model.id) &&\n\t\t\t\t\t\t\t\tmodel.providers &&\n\t\t\t\t\t\t\t\tmodel.providers.length > 1 && (\n\t\t\t\t\t\t\t\t\t<div className=\"ml-4 space-y-1 border-border border-l pl-3\">\n\t\t\t\t\t\t\t\t\t\t{model.providers.map((provider) => (\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\tkey={`${provider.providerId}-${provider.modelName}`}\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"flex cursor-pointer items-center justify-between rounded px-2 py-1 text-xs transition-colors hover:bg-accent/50\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tisProviderSelected(model, provider.providerId) &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"bg-accent/70 ring-1 ring-primary/50\",\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\t\thandleModelSelect(model, provider.providerId);\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{provider.providerId}\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{formatPrice(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tprovider.pricing?.prompt ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treadDynamicPrice(provider.pricing, \"input\") ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"0\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t/1K\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</TooltipTrigger>\n\t\t\t\t\t<TooltipContent\n\t\t\t\t\t\tside=\"right\"\n\t\t\t\t\t\tclassName=\"border border-border bg-popover p-0\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{renderModelTooltip(model)}\n\t\t\t\t\t</TooltipContent>\n\t\t\t\t</Tooltip>\n\t\t\t</TooltipProvider>\n\t\t),\n\t\t[\n\t\t\tisModelSelected,\n\t\t\thandleModelSelect,\n\t\t\tformatPrice,\n\t\t\texpandedModels,\n\t\t\ttoggleModelExpanded,\n\t\t\tisProviderSelected,\n\t\t\trenderModelTooltip,\n\t\t\treadDynamicPrice,\n\t\t],\n\t);\n\n\tconst trigger = useMemo(\n\t\t() => (\n\t\t\t<Button variant=\"outline\" className={cn(\"justify-between\", className)}>\n\t\t\t\t<div className=\"flex min-w-0 flex-1 items-center gap-2\">\n\t\t\t\t\t<div className=\"truncate font-medium text-sm\">{getDisplayText()}</div>\n\t\t\t\t</div>\n\t\t\t\t<CaretDownIcon className=\"ml-2 size-4 flex-shrink-0 opacity-50\" />\n\t\t\t</Button>\n\t\t),\n\t\t[className, getDisplayText],\n\t);\n\n\tif (loading && !isDropdownOpen && !isDrawerOpen) {\n\t\treturn (\n\t\t\t<Button\n\t\t\t\tvariant=\"outline\"\n\t\t\t\tclassName={cn(\"justify-between\", className)}\n\t\t\t\tdisabled\n\t\t\t>\n\t\t\t\t<span>Loading models...</span>\n\t\t\t\t<CaretDownIcon className=\"size-4 opacity-50\" />\n\t\t\t</Button>\n\t\t);\n\t}\n\n\tif (err) {\n\t\treturn (\n\t\t\t<Button\n\t\t\t\tvariant=\"outline\"\n\t\t\t\tclassName={cn(\"justify-between\", className)}\n\t\t\t\tdisabled\n\t\t\t>\n\t\t\t\t<span className=\"text-red-500\">Error loading models</span>\n\t\t\t\t<CaretDownIcon className=\"size-4 opacity-50\" />\n\t\t\t</Button>\n\t\t);\n\t}\n\n\tif (isMobile) {\n\t\treturn (\n\t\t\t<TooltipProvider>\n\t\t\t\t<Drawer\n\t\t\t\t\topen={isDrawerOpen}\n\t\t\t\t\tonOpenChange={(open) => {\n\t\t\t\t\t\tsetIsDrawerOpen(open);\n\t\t\t\t\t\tif (!open) {\n\t\t\t\t\t\t\tsetExpandedModels(new Set());\n\t\t\t\t\t\t}\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<DrawerTrigger asChild>{trigger}</DrawerTrigger>\n\t\t\t\t\t<DrawerContent>\n\t\t\t\t\t\t<DrawerHeader>\n\t\t\t\t\t\t\t<DrawerTitle>Select Model</DrawerTitle>\n\t\t\t\t\t\t</DrawerHeader>\n\t\t\t\t\t\t<div className=\"px-4 pb-2\">\n\t\t\t\t\t\t\t<div className=\"relative\">\n\t\t\t\t\t\t\t\t<MagnifyingGlassIcon className=\"absolute top-2.5 left-2.5 h-4 w-4 text-muted-foreground\" />\n\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\tref={searchInputRef}\n\t\t\t\t\t\t\t\t\tplaceholder={`Search ${filteredModels.length} models...`}\n\t\t\t\t\t\t\t\t\tclassName=\"pr-10 pl-8\"\n\t\t\t\t\t\t\t\t\tautoFocus\n\t\t\t\t\t\t\t\t\tvalue={searchQuery}\n\t\t\t\t\t\t\t\t\tonChange={handleSearchChange}\n\t\t\t\t\t\t\t\t\tonClick={(e) => e.stopPropagation()}\n\t\t\t\t\t\t\t\t/>\n                                <div className=\"-top-9 absolute right-0 flex items-center gap-2 text-xs\">\n                                    <span className=\"text-muted-foreground\">AI Gateway</span>\n                                    <Tooltip>\n                                        <TooltipTrigger asChild>\n                                            <span>\n                                                <Switch\n                                                    checked={useAiGateway}\n                                                    disabled={!hasAiGatewayKey && !useAiGateway}\n                                                    onCheckedChange={(v) => {\n                                                        if (v && !hasAiGatewayKey) return;\n                                                        setModelsSource(v);\n                                                    }}\n                                                    aria-label=\"Toggle AI Gateway models\"\n                                                />\n                                            </span>\n                                        </TooltipTrigger>\n                                        {!hasAiGatewayKey && !useAiGateway && (\n                                            <TooltipContent side=\"bottom\">\n                                                <span className=\"text-xs\">Add your Vercel AI Gateway API key to enable</span>\n                                            </TooltipContent>\n                                        )}\n                                    </Tooltip>\n                                </div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{!useAiGateway && (\n\t\t\t\t\t\t\t\t<Popover>\n\t\t\t\t\t\t\t\t\t<PopoverTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\taria-label=\"Open filters\"\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"absolute top-1.5 right-1.5 h-7 w-7 p-0 hover:bg-accent/50\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<SlidersHorizontalIcon className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t</PopoverTrigger>\n\t\t\t\t\t\t\t\t\t<PopoverContent align=\"end\" className=\"w-80 space-y-3 p-3\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-3\">\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Label htmlFor=\"f-streaming\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tStreaming\n\t\t\t\t\t\t\t\t\t\t\t\t</Label>\n\t\t\t\t\t\t\t\t\t\t\t\t<Switch\n\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"f-streaming\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tchecked={filters.streaming}\n\t\t\t\t\t\t\t\t\t\t\t\t\tonCheckedChange={(v) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetFilters((p) => ({ ...p, streaming: v }))\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Label htmlFor=\"f-vision\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tVision\n\t\t\t\t\t\t\t\t\t\t\t\t</Label>\n\t\t\t\t\t\t\t\t\t\t\t\t<Switch\n\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"f-vision\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tchecked={filters.vision}\n\t\t\t\t\t\t\t\t\t\t\t\t\tonCheckedChange={(v) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetFilters((p) => ({ ...p, vision: v }))\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Label htmlFor=\"f-tools\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tTools\n\t\t\t\t\t\t\t\t\t\t\t\t</Label>\n\t\t\t\t\t\t\t\t\t\t\t\t<Switch\n\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"f-tools\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tchecked={filters.tools}\n\t\t\t\t\t\t\t\t\t\t\t\t\tonCheckedChange={(v) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetFilters((p) => ({ ...p, tools: v }))\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t<Label htmlFor=\"f-json\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tJSON Output\n\t\t\t\t\t\t\t\t\t\t\t\t</Label>\n\t\t\t\t\t\t\t\t\t\t\t\t<Switch\n\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"f-json\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tchecked={filters.jsonOutput}\n\t\t\t\t\t\t\t\t\t\t\t\t\tonCheckedChange={(v) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetFilters((p) => ({ ...p, jsonOutput: v }))\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-3\">\n\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t<Label htmlFor=\"f-provider\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tProvider\n\t\t\t\t\t\t\t\t\t\t\t\t</Label>\n\t\t\t\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"f-provider\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"e.g. openai\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={String(filters.providerQuery)}\n\t\t\t\t\t\t\t\t\t\t\t\t\tonChange={(e) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetFilters((p) => ({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t...p,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tproviderQuery: e.target.value,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}))\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-8\"\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t<Label htmlFor=\"f-minctx\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tMin context\n\t\t\t\t\t\t\t\t\t\t\t\t</Label>\n\t\t\t\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"f-minctx\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tmin={0}\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={String(filters.minContext)}\n\t\t\t\t\t\t\t\t\t\t\t\t\tonChange={(e) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetFilters((p) => ({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t...p,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tminContext: e.target.value,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}))\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-8\"\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t<Label htmlFor=\"f-maxprice\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tMax prompt $/1K\n\t\t\t\t\t\t\t\t\t\t\t\t</Label>\n\t\t\t\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"f-maxprice\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tmin={0}\n\t\t\t\t\t\t\t\t\t\t\t\t\tstep=\"0.0001\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={String(filters.maxPromptPrice)}\n\t\t\t\t\t\t\t\t\t\t\t\t\tonChange={(e) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetFilters((p) => ({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t...p,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmaxPromptPrice: e.target.value,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}))\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-8\"\n\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t<Label htmlFor=\"f-status\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\tStatus\n\t\t\t\t\t\t\t\t\t\t\t\t</Label>\n\t\t\t\t\t\t\t\t\t\t\t\t<select\n\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"f-status\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-8 w-full rounded-md border bg-background px-2 text-sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={filters.status}\n\t\t\t\t\t\t\t\t\t\t\t\t\tonChange={(e) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetFilters((p) => ({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t...p,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstatus: e.target.value as ModelStatusFilter,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}))\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"any\">Any</option>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"active\">Active</option>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"deprecated\">Deprecated</option>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"deactivated\">Deactivated</option>\n\t\t\t\t\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetFilters({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstreaming: false,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvision: false,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttools: false,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tjsonOutput: false,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmoderatedMode: \"any\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstatus: \"any\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tproviderQuery: \"\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tminContext: \"\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmaxPromptPrice: \"\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\tReset\n\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</PopoverContent>\n\t\t\t\t\t\t\t\t</Popover>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className=\"flex h-full flex-col space-y-0.5 overflow-y-auto px-4 pb-6\">\n\t\t\t\t\t\t\t{filteredModels.length > 0 ? (\n\t\t\t\t\t\t\t\tfilteredModels.map((model) => (\n\t\t\t\t\t\t\t\t\t<div key={model.id} className=\"w-full\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex w-full items-center justify-between gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"flex w-full flex-1 cursor-pointer items-center justify-between rounded-md px-3 py-2 transition-colors hover:bg-accent\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tisModelSelected(model) &&\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"border border-primary/30 bg-accent\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tmodel.deactivated_at && \"opacity-60\",\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleModelSelect(model)}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex min-w-0 flex-1 items-center gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"truncate font-medium text-sm\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{model.name}\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{isModelSelected(model) && (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"size-2 flex-shrink-0 rounded-full bg-primary\" />\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{formatPrice(model.pricing?.prompt || \"0\")}/1K\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t\t\t\t\t\t{model.providers && model.providers.length > 1 && (\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-8 w-8 p-0 hover:bg-accent/50\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoggleModelExpanded(model.id);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<CaretDownIcon\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"size-3 transition-transform\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\texpandedModels.has(model.id) && \"rotate-180\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t\t\t\t{expandedModels.has(model.id) &&\n\t\t\t\t\t\t\t\t\t\t\tmodel.providers &&\n\t\t\t\t\t\t\t\t\t\t\tmodel.providers.length > 1 && (\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"mt-1 ml-4 space-y-1 border-border border-l pl-3\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t{model.providers.map((provider) => (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tkey={`${provider.providerId}-${provider.modelName}`}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={cn(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"flex cursor-pointer items-center justify-between rounded px-2 py-1 text-xs transition-colors hover:bg-accent/50\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tisProviderSelected(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmodel,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tprovider.providerId,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) && \"bg-accent/70 ring-1 ring-primary/50\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thandleModelSelect(model, provider.providerId);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{provider.providerId}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-muted-foreground\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{formatPrice(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tprovider.pricing?.prompt ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treadDynamicPrice(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tprovider.pricing,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"input\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) ||\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"0\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/1K\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t))\n\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t<div className=\"flex h-full flex-col items-center justify-center p-6 text-center\">\n\t\t\t\t\t\t\t\t\t<p className=\"mb-2 text-muted-foreground text-sm\">\n\t\t\t\t\t\t\t\t\t\tNo results found.\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</DrawerContent>\n\t\t\t\t</Drawer>\n\t\t\t</TooltipProvider>\n\t\t);\n\t}\n\n\treturn (\n\t\t<TooltipProvider>\n\t\t\t<DropdownMenu\n\t\t\t\topen={isDropdownOpen}\n\t\t\t\tonOpenChange={(open) => {\n\t\t\t\t\tsetIsDropdownOpen(open);\n\t\t\t\t\tif (!open) {\n\t\t\t\t\t\tsetSearchQuery(\"\");\n\t\t\t\t\t\tsetExpandedModels(new Set());\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<DropdownMenuTrigger asChild>{trigger}</DropdownMenuTrigger>\n\t\t\t\t<DropdownMenuContent\n\t\t\t\t\tclassName=\"flex h-[400px] w-[400px] flex-col space-y-0.5 overflow-visible px-0 pt-0\"\n\t\t\t\t\talign=\"start\"\n\t\t\t\t\tsideOffset={4}\n\t\t\t\t\tforceMount\n\t\t\t\t\tside=\"top\"\n\t\t\t\t>\n\t\t\t\t\t<div className=\"sticky top-0 z-10 rounded-t-md border-b bg-background px-0 pt-0 pb-0\">\n\t\t\t\t\t\t<div className=\"relative\">\n\t\t\t\t\t\t\t<MagnifyingGlassIcon className=\"absolute top-2.5 left-2.5 h-4 w-4 text-muted-foreground\" />\n\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\tref={searchInputRef}\n\t\t\t\t\t\t\t\tplaceholder={`Search ${filteredModels.length} ${useAiGateway ? \"AI Gateway\" : \"LLM Gateway\"} models...`}\n\t\t\t\t\t\t\t\tclassName=\"rounded-b-none border border-none pr-10 pl-8 shadow-none focus-visible:ring-0 dark:bg-popover\"\n\t\t\t\t\t\t\t\tautoFocus\n\t\t\t\t\t\t\t\tvalue={searchQuery}\n\t\t\t\t\t\t\t\tonChange={handleSearchChange}\n\t\t\t\t\t\t\t\tonClick={(e) => e.stopPropagation()}\n\t\t\t\t\t\t\t\tonFocus={(e) => e.stopPropagation()}\n\t\t\t\t\t\t\t\tonKeyDown={(e) => e.stopPropagation()}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t{/* Desktop gateway toggle with icons */}\n                            <div className=\"absolute top-1.5 right-10 z-10 flex items-center gap-1\">\n                                <button\n                                    type=\"button\"\n                                    aria-label=\"Use LLM Gateway\"\n                                    className={cn(\n                                        \"flex h-6 w-6 items-center justify-center rounded border\",\n                                        !useAiGateway\n                                            ? \"border-primary bg-accent\"\n                                            : \"border-border bg-transparent\",\n                                    )}\n                                    onClick={(e) => {\n                                        e.stopPropagation();\n                                        setModelsSource(false);\n                                        setIsDropdownOpen(true);\n                                    }}\n                                >\n                                    <svg\n                                        role=\"img\"\n                                        aria-label=\"LLM Gateway\"\n                                        fill=\"none\"\n                                        className=\"h-3.5 w-3.5\"\n                                        viewBox=\"0 0 218 232\"\n                                        xmlns=\"http://www.w3.org/2000/svg\"\n                                    >\n                                        <path\n                                            d=\"M218 59.4686c0-4.1697-2.351-7.9813-6.071-9.8441L119.973 3.58361s2.926 3.32316 2.926 7.01529V218.833c0 4.081-2.926 7.016-2.926 7.016l15.24-7.468c2.964-2.232 7.187-7.443 7.438-16.006.293-9.976.61-84.847.732-121.0353.487-3.6678 4.096-11.0032 14.63-11.0032 10.535 0 29.262 5.1348 37.309 7.7022 2.439.7336 7.608 4.1812 8.779 12.1036 1.17 7.9223.975 59.0507.731 83.6247 0 2.445.137 7.069 6.653 7.069 6.515 0 6.515-7.069 6.515-7.069V59.4686Z\"\n                                            fill=\"currentColor\"\n                                        />\n                                        <path\n                                            d=\"M149.235 86.323c0-5.5921 5.132-9.7668 10.589-8.6132l31.457 6.6495c4.061.8585 6.967 4.4207 6.967 8.5824v81.9253c0 5.868 5.121 9.169 5.121 9.169l-51.9-12.658c-1.311-.32-2.234-1.498-2.234-2.852V86.323ZM99.7535 1.15076c7.2925-3.60996 15.8305 1.71119 15.8305 9.86634V220.983c0 8.155-8.538 13.476-15.8305 9.866L6.11596 184.496C2.37105 182.642 0 178.818 0 174.63v-17.868l49.7128 19.865c4.0474 1.617 8.4447-1.372 8.4449-5.741 0-2.66-1.6975-5.022-4.2142-5.863L0 146.992v-14.305l40.2756 7.708c3.9656.759 7.6405-2.289 7.6405-6.337 0-3.286-2.4628-6.048-5.7195-6.413L0 122.917V108.48l78.5181-3.014c4.1532-.16 7.4381-3.582 7.4383-7.7498 0-4.6256-4.0122-8.2229-8.5964-7.7073L0 98.7098V82.4399l53.447-17.8738c2.3764-.7948 3.9791-3.0254 3.9792-5.5374 0-4.0961-4.0978-6.9185-7.9106-5.4486L0 72.6695V57.3696c.0000304-4.1878 2.37107-8.0125 6.11596-9.8664L99.7535 1.15076Z\"\n                                            fill=\"currentColor\"\n                                        />\n                                    </svg>\n                                </button>\n                                <Tooltip>\n                                    <TooltipTrigger asChild>\n                                        <span>\n                                            <button\n                                                type=\"button\"\n                                                aria-label=\"Use AI Gateway\"\n                                                disabled={!hasAiGatewayKey}\n                                                className={cn(\n                                                    \"flex h-6 w-6 items-center justify-center rounded border\",\n                                                    useAiGateway\n                                                        ? \"border-primary bg-accent\"\n                                                        : \"border-border bg-transparent\",\n                                                    !hasAiGatewayKey && \"cursor-not-allowed opacity-50\",\n                                                )}\n                                                onClick={(e) => {\n                                                    e.stopPropagation();\n                                                    if (!hasAiGatewayKey) return;\n                                                    setModelsSource(true);\n                                                    setIsDropdownOpen(true);\n                                                }}\n                                            >\n                                                <svg\n                                                    role=\"img\"\n                                                    aria-label=\"AI Gateway\"\n                                                    viewBox=\"0 0 256 222\"\n                                                    width=\"12\"\n                                                    height=\"10\"\n                                                    xmlns=\"http://www.w3.org/2000/svg\"\n                                                    preserveAspectRatio=\"xMidYMid\"\n                                                >\n                                                    <path fill=\"currentColor\" d=\"m128 0 128 221.705H0z\" />\n                                                </svg>\n                                            </button>\n                                        </span>\n                                    </TooltipTrigger>\n                                    {!hasAiGatewayKey && (\n                                        <TooltipContent side=\"bottom\">\n                                            <span className=\"text-xs\">Add your Vercel AI Gateway API key to enable</span>\n                                        </TooltipContent>\n                                    )}\n                                </Tooltip>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{!useAiGateway && (\n\t\t\t\t\t\t\t<Popover>\n\t\t\t\t\t\t\t\t<PopoverTrigger asChild>\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\taria-label=\"Open filters\"\n\t\t\t\t\t\t\t\t\t\tclassName=\"absolute top-1.5 right-1.5 h-7 w-7 p-0 hover:bg-accent/50\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<SlidersHorizontalIcon className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t</PopoverTrigger>\n\t\t\t\t\t\t\t\t<PopoverContent align=\"center\" className=\"w-80 space-y-3 p-3\">\n\t\t\t\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-3\">\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t<Label htmlFor=\"hf-streaming\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\tStreaming\n\t\t\t\t\t\t\t\t\t\t\t</Label>\n\t\t\t\t\t\t\t\t\t\t\t<Switch\n\t\t\t\t\t\t\t\t\t\t\t\tid=\"hf-streaming\"\n\t\t\t\t\t\t\t\t\t\t\t\tchecked={filters.streaming}\n\t\t\t\t\t\t\t\t\t\t\t\tonCheckedChange={(v) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetFilters((p) => ({ ...p, streaming: v }))\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t<Label htmlFor=\"hf-vision\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\tVision\n\t\t\t\t\t\t\t\t\t\t\t</Label>\n\t\t\t\t\t\t\t\t\t\t\t<Switch\n\t\t\t\t\t\t\t\t\t\t\t\tid=\"hf-vision\"\n\t\t\t\t\t\t\t\t\t\t\t\tchecked={filters.vision}\n\t\t\t\t\t\t\t\t\t\t\t\tonCheckedChange={(v) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetFilters((p) => ({ ...p, vision: v }))\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t<Label htmlFor=\"hf-tools\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\tTools\n\t\t\t\t\t\t\t\t\t\t\t</Label>\n\t\t\t\t\t\t\t\t\t\t\t<Switch\n\t\t\t\t\t\t\t\t\t\t\t\tid=\"hf-tools\"\n\t\t\t\t\t\t\t\t\t\t\t\tchecked={filters.tools}\n\t\t\t\t\t\t\t\t\t\t\t\tonCheckedChange={(v) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetFilters((p) => ({ ...p, tools: v }))\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{/* Reasoning filter removed */}\n\t\t\t\t\t\t\t\t\t\t{/* Cancellation filter removed */}\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t<Label htmlFor=\"hf-json\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\tJSON Output\n\t\t\t\t\t\t\t\t\t\t\t</Label>\n\t\t\t\t\t\t\t\t\t\t\t<Switch\n\t\t\t\t\t\t\t\t\t\t\t\tid=\"hf-json\"\n\t\t\t\t\t\t\t\t\t\t\t\tchecked={filters.jsonOutput}\n\t\t\t\t\t\t\t\t\t\t\t\tonCheckedChange={(v) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetFilters((p) => ({ ...p, jsonOutput: v }))\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{/* <div className=\"flex items-center justify-between gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t<Label htmlFor=\"hf-moderated\" className=\"text-xs\">Moderation</Label>\n\t\t\t\t\t\t\t\t\t\t\t<select id=\"hf-moderated\" className=\"h-8 w-36 rounded-md border bg-background px-2 text-xs\" value={filters.moderatedMode} onChange={(e) => setFilters((p) => ({ ...p, moderatedMode: e.target.value as any }))}>\n\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"any\">Any</option>\n\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"moderated\">Moderated</option>\n\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"unmoderated\">Unmoderated</option>\n\t\t\t\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t\t\t\t</div> */}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-3\">\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t<Label htmlFor=\"hf-provider\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\tProvider\n\t\t\t\t\t\t\t\t\t\t\t</Label>\n\t\t\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\t\t\tid=\"hf-provider\"\n\t\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"e.g. openai\"\n\t\t\t\t\t\t\t\t\t\t\t\tvalue={String(filters.providerQuery)}\n\t\t\t\t\t\t\t\t\t\t\t\tonChange={(e) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetFilters((p) => ({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t...p,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tproviderQuery: e.target.value,\n\t\t\t\t\t\t\t\t\t\t\t\t\t}))\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-8\"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t<Label htmlFor=\"hf-status\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\tStatus\n\t\t\t\t\t\t\t\t\t\t\t</Label>\n\t\t\t\t\t\t\t\t\t\t\t<select\n\t\t\t\t\t\t\t\t\t\t\t\tid=\"hf-status\"\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-8 w-full rounded-md border bg-background px-2 text-sm\"\n\t\t\t\t\t\t\t\t\t\t\t\tvalue={filters.status}\n\t\t\t\t\t\t\t\t\t\t\t\tonChange={(e) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetFilters((p) => ({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t...p,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tstatus: e.target.value as ModelStatusFilter,\n\t\t\t\t\t\t\t\t\t\t\t\t\t}))\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"any\">Any</option>\n\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"active\">Active</option>\n\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"deprecated\">Deprecated</option>\n\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"deactivated\">Deactivated</option>\n\t\t\t\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\t\t\t\t\tsetFilters({\n\t\t\t\t\t\t\t\t\t\t\t\t\tstreaming: false,\n\t\t\t\t\t\t\t\t\t\t\t\t\tvision: false,\n\t\t\t\t\t\t\t\t\t\t\t\t\ttools: false,\n\t\t\t\t\t\t\t\t\t\t\t\t\tjsonOutput: false,\n\t\t\t\t\t\t\t\t\t\t\t\t\tmoderatedMode: \"any\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tstatus: \"any\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tproviderQuery: \"\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tminContext: \"\",\n\t\t\t\t\t\t\t\t\t\t\t\t\tmaxPromptPrice: \"\",\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\tReset\n\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</PopoverContent>\n\t\t\t\t\t\t\t</Popover>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"flex h-full flex-col space-y-0.5 overflow-y-auto px-1 pt-1 pb-0\">\n\t\t\t\t\t\t{filteredModels.length > 0 ? (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t{searchQuery && (\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between px-3 py-2 text-xs\">\n\t\t\t\t\t\t\t\t\t\tShowing {filteredModels.length} of {(models || []).length} models\n\t\t\t\t\t\t\t\t\t\t<Popover>\n\t\t\t\t\t\t\t\t\t\t\t<PopoverTrigger asChild>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-7 px-2\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<SlidersHorizontalIcon className=\"h-4 w-4\" />\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</PopoverTrigger>\n\t\t\t\t\t\t\t\t\t\t\t<PopoverContent\n\t\t\t\t\t\t\t\t\t\t\t\talign=\"end\"\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"w-80 space-y-3 p-3\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-3\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Label htmlFor=\"df-streaming\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tStreaming\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Label>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Switch\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"df-streaming\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tchecked={filters.streaming}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonCheckedChange={(v) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetFilters((p) => ({ ...p, streaming: v }))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Label htmlFor=\"df-vision\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tVision\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Label>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Switch\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"df-vision\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tchecked={filters.vision}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonCheckedChange={(v) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetFilters((p) => ({ ...p, vision: v }))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Label htmlFor=\"df-tools\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tTools\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Label>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Switch\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"df-tools\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tchecked={filters.tools}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonCheckedChange={(v) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetFilters((p) => ({ ...p, tools: v }))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Cancellation filter removed */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between gap-2\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Label htmlFor=\"df-json\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tJSON Output\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Label>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Switch\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"df-json\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tchecked={filters.jsonOutput}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonCheckedChange={(v) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetFilters((p) => ({ ...p, jsonOutput: v }))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"grid grid-cols-2 gap-3\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Label htmlFor=\"df-provider\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tProvider\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Label>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"df-provider\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"e.g. openai\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={String(filters.providerQuery)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonChange={(e) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetFilters((p) => ({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t...p,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tproviderQuery: e.target.value,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-8\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Label htmlFor=\"df-minctx\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tMin context\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Label>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"df-minctx\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmin={0}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={String(filters.minContext)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonChange={(e) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetFilters((p) => ({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t...p,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tminContext: e.target.value,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-8\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Label htmlFor=\"df-maxprice\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tMax prompt $/1K\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Label>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Input\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"df-maxprice\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"number\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmin={0}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstep=\"0.0001\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={String(filters.maxPromptPrice)}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonChange={(e) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetFilters((p) => ({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t...p,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmaxPromptPrice: e.target.value,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-8\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Label htmlFor=\"df-status\" className=\"text-xs\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tStatus\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Label>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<select\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tid=\"df-status\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"h-8 w-full rounded-md border bg-background px-2 text-sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={filters.status}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonChange={(e) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetFilters((p) => ({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t...p,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstatus: e.target.value as ModelStatusFilter,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}))\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"any\">Any</option>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"active\">Active</option>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"deprecated\">Deprecated</option>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"deactivated\">Deactivated</option>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvariant=\"ghost\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsize=\"sm\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetFilters({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstreaming: false,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvision: false,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttools: false,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tjsonOutput: false,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmoderatedMode: \"any\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstatus: \"any\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tproviderQuery: \"\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tminContext: \"\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmaxPromptPrice: \"\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tReset\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</PopoverContent>\n\t\t\t\t\t\t\t\t\t\t</Popover>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{filteredModels.map(renderModelItem)}\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<div className=\"flex h-full flex-col items-center justify-center p-6 text-center\">\n\t\t\t\t\t\t\t\t<p className=\"mb-1 text-muted-foreground text-sm\">\n\t\t\t\t\t\t\t\t\tNo results found.\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t{searchQuery && (\n\t\t\t\t\t\t\t\t\t<p className=\"text-muted-foreground text-xs\">\n\t\t\t\t\t\t\t\t\t\tTry searching for a different model or provider.\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t</DropdownMenuContent>\n\t\t\t</DropdownMenu>\n\t\t</TooltipProvider>\n\t);\n}\n\nexport { ModelSelector };\nexport default ModelSelector;\n",
      "type": "registry:component",
      "target": "components/model-selector/model-selector.tsx"
    },
    {
      "path": "src/registry/blocks/model-selector/use-models.ts",
      "content": "\"use client\";\n\nimport { useCallback, useEffect, useRef, useState } from \"react\";\n\n// Minimal type used internally by this hook. The component defines its own display type.\ntype LLMGatewayModel = {\n\tid: string;\n\tname: string;\n\tdescription?: string;\n\tfamily?: string;\n\tarchitecture?: Record<string, unknown>;\n\tproviders?: Array<{\n\t\tproviderId: string;\n\t\tmodelName: string;\n\t\tpricing?: Record<string, unknown>;\n\t\tstreaming?: boolean;\n\t\tvision?: boolean;\n\t\ttools?: boolean;\n\t}>;\n\tpricing?: Record<string, string | undefined>;\n\tcontext_length?: number;\n\tjson_output?: boolean;\n\tdeprecated_at?: string | null;\n\tdeactivated_at?: string | null;\n};\n\ntype Source = \"llm\" | \"aigw\";\n\nlet memoryCache: Record<\n\tSource,\n\t{ data: LLMGatewayModel[] | null; timestamp: number }\n> = {\n\tllm: { data: null, timestamp: 0 },\n\taigw: { data: null, timestamp: 0 },\n};\n\n// De-duplicate concurrent network requests across multiple hook instances\nconst inflightFetch: Partial<Record<Source, Promise<LLMGatewayModel[]>>> = {};\n\nconst LOCAL_STORAGE_KEY_BASE = \"llm_models_cache_v1\";\nconst CACHE_DURATION_MS = 5 * 60 * 1000; // 5 minutes\n\nfunction lsKeyFor(source: Source): string {\n\treturn `${LOCAL_STORAGE_KEY_BASE}_${source}`;\n}\n\nfunction readLocalStorageCache(source: Source): {\n\tdata: LLMGatewayModel[] | null;\n\ttimestamp: number;\n} {\n\tif (typeof window === \"undefined\") return { data: null, timestamp: 0 };\n\ttry {\n\t\tconst raw = window.localStorage.getItem(lsKeyFor(source));\n\t\tif (!raw) return { data: null, timestamp: 0 };\n\t\tconst parsed = JSON.parse(raw) as {\n\t\t\tdata: LLMGatewayModel[];\n\t\t\ttimestamp: number;\n\t\t};\n\t\treturn parsed && Array.isArray(parsed.data)\n\t\t\t? { data: parsed.data, timestamp: parsed.timestamp || 0 }\n\t\t\t: { data: null, timestamp: 0 };\n\t} catch {\n\t\treturn { data: null, timestamp: 0 };\n\t}\n}\n\nfunction writeLocalStorageCache(source: Source, data: LLMGatewayModel[]) {\n\tif (typeof window === \"undefined\") return;\n\ttry {\n\t\twindow.localStorage.setItem(\n\t\t\tlsKeyFor(source),\n\t\t\tJSON.stringify({ data, timestamp: Date.now() }),\n\t\t);\n\t} catch {\n\t\t// ignore storage errors (quota, privacy, etc.)\n\t}\n}\n\ntype UseModelsResult = {\n\tmodels: LLMGatewayModel[];\n\tisLoading: boolean;\n\terror: string | null;\n\trefresh: () => Promise<void>;\n};\n\nexport function useLLMModels(options?: {\n\tsource?: \"aigateway\" | \"llmgateway\";\n\tcontrolled?: boolean;\n}): UseModelsResult {\n\tconst [models, setModels] = useState<LLMGatewayModel[]>([]);\n\tconst [isLoading, setIsLoading] = useState<boolean>(true);\n\tconst [error, setError] = useState<string | null>(null);\n\tconst [useAiGateway, setUseAiGateway] = useState<boolean>(false);\n\tconst prefetchingRef = useRef(false);\n\n\tconst isControlled =\n\t\tBoolean(options?.controlled) && typeof options?.source === \"string\";\n\tconst controlledUseAiGateway = options?.source === \"aigateway\";\n\n\tconst fetchModels = useCallback(\n\t\tasync (overrideUseAiGateway?: boolean) => {\n\t\t\tsetIsLoading(true);\n\t\t\tsetError(null);\n\t\t\ttry {\n\t\t\t\tconst effectiveUseAiGateway =\n\t\t\t\t\ttypeof overrideUseAiGateway === \"boolean\"\n\t\t\t\t\t\t? overrideUseAiGateway\n\t\t\t\t\t\t: isControlled\n\t\t\t\t\t\t\t? controlledUseAiGateway\n\t\t\t\t\t\t\t: useAiGateway;\n\t\t\t\tconst route = effectiveUseAiGateway\n\t\t\t\t\t? \"/api/models/ai-gateway\"\n\t\t\t\t\t: \"/api/models\";\n\t\t\t\t// For AI Gateway, read from localStorage key set by the registry UI\n\t\t\t\tlet headerKey = \"\";\n\t\t\t\tif (typeof window !== \"undefined\") {\n\t\t\t\t\theaderKey = window.localStorage?.getItem(\"chaichat_registry_aigateway\") || \"\";\n\t\t\t\t}\n\t\t\t\tconst source: Source = effectiveUseAiGateway ? \"aigw\" : \"llm\";\n\n\t\t\t\tif (!inflightFetch[source]) {\n\t\t\t\t\tinflightFetch[source] = (async () => {\n\t\t\t\t\t\tconst response = await fetch(route, {\n\t\t\t\t\t\t\theaders:\n\t\t\t\t\t\t\t\teffectiveUseAiGateway && headerKey\n\t\t\t\t\t\t\t\t\t? { Authorization: `Bearer ${headerKey}` }\n\t\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (!response.ok) throw new Error(`HTTP ${response.status}`);\n\t\t\t\t\t\tconst payload = (await response.json()) as {\n\t\t\t\t\t\t\tmodels?: LLMGatewayModel[];\n\t\t\t\t\t\t};\n\t\t\t\t\t\tconst nextModels = Array.isArray(payload.models)\n\t\t\t\t\t\t\t? payload.models\n\t\t\t\t\t\t\t: [];\n\t\t\t\t\t\tmemoryCache[source] = { data: nextModels, timestamp: Date.now() };\n\t\t\t\t\t\twriteLocalStorageCache(source, nextModels);\n\t\t\t\t\t\treturn nextModels;\n\t\t\t\t\t})();\n\t\t\t\t}\n\n\t\t\t\tconst inflight = inflightFetch[source];\n\t\t\t\tconst result = inflight ? await inflight : [];\n\t\t\t\tsetModels(result);\n\t\t\t\t// cleanup once resolved so future refreshes can occur\n\t\t\t\tdelete inflightFetch[source];\n\t\t\t} catch (err) {\n\t\t\t\tsetError(err instanceof Error ? err.message : \"Failed to load models\");\n\t\t\t} finally {\n\t\t\t\tsetIsLoading(false);\n\t\t\t}\n\t\t},\n\t\t[useAiGateway, isControlled, controlledUseAiGateway],\n\t);\n\n\tconst refresh = useCallback(async () => {\n\t\tmemoryCache = {\n\t\t\tllm: { data: null, timestamp: 0 },\n\t\t\taigw: { data: null, timestamp: 0 },\n\t\t};\n\t\tawait fetchModels();\n\t}, [fetchModels]);\n\n\tuseEffect(() => {\n\t\tlet isMounted = true;\n\n\t\tif (!isControlled) {\n\t\t\tif (prefetchingRef.current) {\n\t\t\t\treturn () => {\n\t\t\t\t\tisMounted = false;\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tconst now = Date.now();\n\t\tconst source: Source = (\n\t\t\tisControlled\n\t\t\t\t? controlledUseAiGateway\n\t\t\t\t: useAiGateway\n\t\t)\n\t\t\t? \"aigw\"\n\t\t\t: \"llm\";\n\t\tconst memData = memoryCache[source].data;\n\t\tconst memFresh =\n\t\t\tmemData && now - memoryCache[source].timestamp < CACHE_DURATION_MS;\n\t\tif (memFresh && Array.isArray(memData)) {\n\t\t\tsetModels(memData);\n\t\t\tsetIsLoading(false);\n\t\t\treturn;\n\t\t}\n\n\t\tconst { data: lsData, timestamp: lsTs } = readLocalStorageCache(source);\n\t\tconst lsFresh = lsData && now - lsTs < CACHE_DURATION_MS;\n\t\tif (lsFresh && Array.isArray(lsData)) {\n\t\t\tmemoryCache[source] = { data: lsData, timestamp: lsTs };\n\t\t\tif (isMounted) {\n\t\t\t\tsetModels(lsData);\n\t\t\t\tsetIsLoading(false);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\t// Otherwise fetch from API\n\t\tfetchModels(isControlled ? controlledUseAiGateway : undefined);\n\n\t\treturn () => {\n\t\t\tisMounted = false;\n\t\t};\n\t}, [fetchModels, useAiGateway, isControlled, controlledUseAiGateway]);\n\n\t// Uncontrolled: Listen to storage events to switch global source\n\tuseEffect(() => {\n\t\tif (isControlled) return;\n\t\tconst readSource = () => {\n\t\t\ttry {\n\t\t\t\tconst raw = window.localStorage.getItem(\"chaichat_registry_models_source\");\n\t\t\t\tconst next = raw === \"aigateway\";\n\t\t\t\tsetUseAiGateway((prev) => {\n\t\t\t\t\tif (prev !== next) {\n\t\t\t\t\t\t// prefetch immediately when toggled to reduce flash\n\t\t\t\t\t\tprefetchingRef.current = true;\n\t\t\t\t\t\tvoid fetchModels(next).finally(() => {\n\t\t\t\t\t\t\tprefetchingRef.current = false;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\treturn next;\n\t\t\t\t});\n\t\t\t} catch {}\n\t\t};\n\t\treadSource();\n\t\tconst onToggle = () => readSource();\n\t\twindow.addEventListener(\"registryModelsSourceChanged\", onToggle as EventListener);\n\t\twindow.addEventListener(\"storage\", onToggle);\n\t\treturn () => {\n\t\t\twindow.removeEventListener(\n\t\t\t\t\"registryModelsSourceChanged\",\n\t\t\t\tonToggle as EventListener,\n\t\t\t);\n\t\t\twindow.removeEventListener(\"storage\", onToggle);\n\t\t};\n\t}, [fetchModels, isControlled]);\n\n\treturn { models, isLoading, error, refresh };\n}\n\nexport function invalidateModelsCache() {\n\tmemoryCache = {\n\t\tllm: { data: null, timestamp: 0 },\n\t\taigw: { data: null, timestamp: 0 },\n\t};\n\tif (typeof window !== \"undefined\") {\n\t\ttry {\n\t\t\twindow.localStorage.removeItem(lsKeyFor(\"llm\"));\n\t\t\twindow.localStorage.removeItem(lsKeyFor(\"aigw\"));\n\t\t} catch {\n\t\t\t// ignore\n\t\t}\n\t}\n}\n\nexport default useLLMModels;\n\n ",
      "type": "registry:hook",
      "target": "components/model-selector/use-models.ts"
    },
    {
      "path": "src/registry/blocks/model-selector/api/models/route.ts",
      "content": "type LLMGatewayModelProvider = {\n\tproviderId: string;\n\tmodelName: string;\n\tpricing?: Record<string, string | undefined>;\n\tstreaming?: boolean;\n\tvision?: boolean;\n\ttools?: boolean;\n};\n\ntype LLMGatewayModel = {\n\tid: string;\n\tname: string;\n\tdescription?: string;\n\tfamily?: string;\n\tarchitecture?: Record<string, unknown>;\n\tproviders?: LLMGatewayModelProvider[];\n\tpricing?: Record<string, string | undefined>;\n\tcontext_length?: number;\n\tjson_output?: boolean;\n\tdeprecated_at?: string | null;\n\tdeactivated_at?: string | null;\n\ttop_provider?: { is_moderated?: boolean };\n};\n\ntype LLMGatewayModelsResponse = {\n\tdata: LLMGatewayModel[];\n};\n\nexport async function GET() {\n\ttry {\n\t\tconst response = await fetch(\"https://api.llmgateway.io/v1/models\");\n\t\tconst data = (await response.json()) as LLMGatewayModelsResponse;\n\n\t\tif (!data.data || !Array.isArray(data.data)) {\n\t\t\tthrow new Error(\"Invalid response format from LLM Gateway\");\n\t\t}\n\n\t\treturn Response.json({\n\t\t\tmodels: data.data.map((model: LLMGatewayModel) => ({\n\t\t\t\tid: model.id,\n\t\t\t\tname: model.name,\n\t\t\t\tdescription: model.description,\n\t\t\t\tfamily: model.family,\n\t\t\t\tcontext_length: model.context_length,\n\t\t\t\tpricing: model.pricing,\n\t\t\t\tproviders: model.providers,\n\t\t\t\tarchitecture: model.architecture,\n\t\t\t\ttop_provider: model.top_provider,\n\t\t\t\tjson_output: model.json_output,\n\t\t\t\tdeprecated_at: model.deprecated_at,\n\t\t\t\tdeactivated_at: model.deactivated_at,\n\t\t\t})),\n\t\t});\n\t} catch (error) {\n\t\tconsole.error(\"Failed to fetch models from LLM Gateway:\", error);\n\t\treturn Response.json({ error: \"Failed to load models\" }, { status: 500 });\n\t}\n}\n\n\n",
      "type": "registry:lib",
      "target": "src/app/api/models/route.ts"
    },
    {
      "path": "src/registry/blocks/model-selector/api/models/ai-gateway/route.ts",
      "content": "import { createGateway } from \"@ai-sdk/gateway\";\nimport type { NextRequest } from \"next/server\";\n\ntype GatewayAvailableModels = {\n\tmodels: Array<{\n\t\tid: string;\n\t\tname?: string;\n\t\tdescription?: string;\n\t\tpricing?: Record<string, unknown>;\n\t}>;\n};\n\nexport async function GET(req: NextRequest) {\n\ttry {\n\t\tconst authHeader =\n\t\t\treq.headers.get(\"authorization\") || req.headers.get(\"Authorization\");\n\t\tconst tokenMatch = authHeader?.match(/Bearer\\s+(.+)/i);\n\t\tconst apiKey = tokenMatch?.[1] || process.env.AI_GATEWAY_API_KEY || \"\";\n\n\t\tif (!apiKey) {\n\t\t\treturn Response.json(\n\t\t\t\t{\n\t\t\t\t\terror:\n\t\t\t\t\t\t\"Missing AI Gateway API key. Provide Authorization: Bearer <key> or set AI_GATEWAY_API_KEY.\",\n\t\t\t\t},\n\t\t\t\t{ status: 401 },\n\t\t\t);\n\t\t}\n\n\t\tconst gateway = createGateway({ apiKey });\n\t\tconst data =\n\t\t\t(await gateway.getAvailableModels()) as unknown as GatewayAvailableModels;\n\t\tconst rawModels = Array.isArray(data.models) ? data.models : [];\n\n\t\tconst mapped = rawModels.map((m) => {\n\t\t\tconst id: string = m.id || m.name || \"\";\n\t\t\tconst name: string = m.name || id?.split(\"/\")?.[1] || id;\n\t\t\tconst description: string | undefined = m.description;\n\t\t\tconst pricing =\n\t\t\t\t(m as unknown as { pricing?: Record<string, unknown> }).pricing || {};\n\t\t\treturn {\n\t\t\t\tid,\n\t\t\t\tname,\n\t\t\t\tdescription,\n\t\t\t\tpricing,\n\t\t\t\tproviders: undefined,\n\t\t\t\tarchitecture: undefined,\n\t\t\t\ttop_provider: undefined,\n\t\t\t\tjson_output: undefined,\n\t\t\t\tdeprecated_at: undefined,\n\t\t\t\tdeactivated_at: undefined,\n\t\t\t};\n\t\t});\n\n\t\treturn Response.json({ models: mapped });\n\t} catch (error) {\n\t\tconsole.error(\"Failed to fetch models from Vercel AI Gateway:\", error);\n\t\treturn Response.json({ error: \"Failed to load models\" }, { status: 500 });\n\t}\n}\n\n\n",
      "type": "registry:lib",
      "target": "src/app/api/models/ai-gateway/route.ts"
    }
  ]
}